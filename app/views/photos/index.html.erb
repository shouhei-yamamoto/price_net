<h1>Photos</h1>

<%= form_with url: photos_path, method: :get, local: true do |form| %>
  <%= form.select("label_id", Label.pluck(:name, :id), { include_blank: "選択してください" }) %>
  <%= form.submit 'ラベル検索', name: nil %>
<% end %> 

<table>
  <thead>
    <tr>
      <th>画像</th>
      <th>値段</th>
     
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @photos.each do |photo| %>
      <tr>
        <td class = 'image'><%= image_tag photo.image.url %></td>
        <td><% photo.products.each do |product| %><%= product.price %> <%= "円" %><% end %></td>
        <td><% photo.labels.each do |label| %><%= label.name %><% end %></td>
        
        <td>
        <% unless photo.user_id == current_user.id %>
        
          <% if photo.favorite_users.ids.include?(current_user.id) %>
            <%= link_to 'お気に入り解除する', favorite_path(id: Favorite.find_by(user_id: current_user.id, photo_id: photo.id).id
             ), method: :delete, class: 'btn btn-danger' %>
          <% else %>
            <%= link_to 'お気に入りする', favorites_path(photo_id: photo.id), method: :photo, class: 'btn btn-primary' %>
          <% end %>
        <% end %>
        </td>

        <td><%= link_to '詳細', photo %></td>

        <% if current_user.id == photo.user_id %>
          <td><%= link_to '編集', edit_photo_path(photo) %></td>
          <td><%= link_to '削除', photo, method: :delete, data: { confirm: '削除してもよろしいですか？' } %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<%= paginate @photos %>


